


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.4.0">
    
    
      
        <title>0. Hello Proxy Users - From Docker to Kubernetes - Multi-Arch with Go and Nodejs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.fe0cca5b.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.a46bcfb3.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-174658170-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview")})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="" data-md-color-accent="">
  
    
      <script>matchMedia("(prefers-color-scheme: dark)").matches&&document.body.setAttribute("data-md-color-scheme","slate")</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hello-proxy-users" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="From Docker to Kubernetes - Multi-Arch with Go and Nodejs" class="md-header-nav__button md-logo" aria-label="From Docker to Kubernetes - Multi-Arch with Go and Nodejs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            From Docker to Kubernetes - Multi-Arch with Go and Nodejs
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              0. Hello Proxy Users
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/siler23/MultiArchDockerKubernetes" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="From Docker to Kubernetes - Multi-Arch with Go and Nodejs" class="md-nav__button md-logo" aria-label="From Docker to Kubernetes - Multi-Arch with Go and Nodejs">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    From Docker to Kubernetes - Multi-Arch with Go and Nodejs
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/siler23/MultiArchDockerKubernetes" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../1-Official-Multiarch/" title="1. Getting Official with Multi-arch Images" class="md-nav__link">
      1. Getting Official with Multi-arch Images
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../2-Best-Practice-Nodejs/" title="2. Learning How to Build Best-practice Node.js Docker Images" class="md-nav__link">
      2. Learning How to Build Best-practice Node.js Docker Images
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../3-Best-Practice-go/" title="3. Guide to Building Best-practice Go Docker Images" class="md-nav__link">
      3. Guide to Building Best-practice Go Docker Images
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      4. Building Multi-arch Docker Images
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="4. Building Multi-arch Docker Images" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        4. Building Multi-arch Docker Images
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../4-Build-MultiArch/" title="Bringing Multi-arch Images to a Computer Near You" class="md-nav__link">
      Bringing Multi-arch Images to a Computer Near You
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../4-Multiarch-buildx-addendum/" title="The future - Using Buildx to make Multi-arch a Way of Life" class="md-nav__link">
      The future - Using Buildx to make Multi-arch a Way of Life
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../4-Multiarch-manual-addendum/" title="The past - The Manual Way aka Herding Cats" class="md-nav__link">
      The past - The Manual Way aka Herding Cats
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../5-Deploy-to-Kubernetes/" title="5. Kubernetes Time" class="md-nav__link">
      5. Kubernetes Time
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        0. Hello Proxy Users
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="0. Hello Proxy Users" class="md-nav__link md-nav__link--active">
      0. Hello Proxy Users
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#docker-proxy-for-pushpull" class="md-nav__link">
    Docker proxy for push/pull
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-your-terminalcommand-prompt-for-proxy" class="md-nav__link">
    Setup your terminal/command prompt for Proxy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-docker-images-behind-proxy" class="md-nav__link">
    Building Docker images behind Proxy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-docker-containers-behind-a-proxy" class="md-nav__link">
    Running Docker containers behind a proxy
  </a>
  
    <nav class="md-nav" aria-label="Running Docker containers behind a proxy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#to-use-a-proxy-with-kubernetes-see-5-deploy-to-kubernetes" class="md-nav__link">
    To use a proxy with Kubernetes see 5-Deploy-to-Kubernetes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference" class="md-nav__link">
    Reference
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onwards" class="md-nav__link">
    Onwards
  </a>
  
    <nav class="md-nav" aria-label="Onwards">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#part-1-getting-official-with-multi-arch-images" class="md-nav__link">
    Part 1: Getting Official with Multi-arch Images
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#docker-proxy-for-pushpull" class="md-nav__link">
    Docker proxy for push/pull
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-your-terminalcommand-prompt-for-proxy" class="md-nav__link">
    Setup your terminal/command prompt for Proxy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-docker-images-behind-proxy" class="md-nav__link">
    Building Docker images behind Proxy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-docker-containers-behind-a-proxy" class="md-nav__link">
    Running Docker containers behind a proxy
  </a>
  
    <nav class="md-nav" aria-label="Running Docker containers behind a proxy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#to-use-a-proxy-with-kubernetes-see-5-deploy-to-kubernetes" class="md-nav__link">
    To use a proxy with Kubernetes see 5-Deploy-to-Kubernetes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference" class="md-nav__link">
    Reference
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onwards" class="md-nav__link">
    Onwards
  </a>
  
    <nav class="md-nav" aria-label="Onwards">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#part-1-getting-official-with-multi-arch-images" class="md-nav__link">
    Part 1: Getting Official with Multi-arch Images
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="hello-proxy-users">Hello Proxy Users<a class="headerlink" href="#hello-proxy-users" title="Permanent link">&para;</a></h1>
<p>We will show how to use a proxy for Docker, how to use a proxy throughout this guide and give links to great proxy user articles.</p>
<h2 id="docker-proxy-for-pushpull">Docker proxy for push/pull<a class="headerlink" href="#docker-proxy-for-pushpull" title="Permanent link">&para;</a></h2>
<p>To setup Docker proxies for <code>docker pull</code> and <code>docker push</code>, you will follow different steps for the different versions of Docker.</p>
<div class="tabbed-set" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><label for="__tabbed_1_1">Windows/mac</label><div class="tabbed-content">
<p>Use the UI. Navigate to Docker Settings in Windows (Preferences in Mac) and fill in the proxy section with your manual proxy configuration like so:</p>
<p><img alt="Manual Proxy Configuration Docker" src="../images/Docker_Proxy_Settings.PNG" />
For more information on setting proxies in Docker for Windows see <a href="https://mandie.net/2017/12/10/docker-for-windows-behind-a-corporate-web-proxy-tips-and-tricks/" target="_blank">Setting Docker Proxies for Windows</a></p>
</div>
<input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><label for="__tabbed_1_2">Linux</label><div class="tabbed-content">
<p>Make a docker.service.d file and restart Docker as below:</p>
<div class="highlight"><pre><span></span><code>mkdir -p /etc/systemd/system/docker.service.d
</code></pre></div>

<div class="highlight"><pre><span></span><code>cat &gt; /etc/systemd/system/docker.service.d/http-proxy.conf <span class="s">&lt;&lt; EOF</span>
<span class="s">[Service]</span>
<span class="s">Environment=&quot;HTTP_PROXY=http://myproxy:8080&quot;</span>
<span class="s">Environment=&quot;HTTPS_PROXY=http://myproxy:8080&quot;</span>
<span class="s">Environment=&quot;NO_PROXY=127.0.0.1,localhost</span>
<span class="s">EOF</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code>systemctl daemon-reload
</code></pre></div>

<div class="highlight"><pre><span></span><code>systemctl restart docker
</code></pre></div>

<p><a href="https://elegantinfrastructure.com/docker/ultimate-guide-to-docker-http-proxy-configuration/" target="_blank">This article goes into detail on how to do this</a></p>
</div>
</div>
<h2 id="setup-your-terminalcommand-prompt-for-proxy">Setup your terminal/command prompt for Proxy<a class="headerlink" href="#setup-your-terminalcommand-prompt-for-proxy" title="Permanent link">&para;</a></h2>
<p>If using a proxy, declare your environment variables to reference in commands. Here is an example with a proxy of <code>http://myproxy:8080</code> and no proxy of localhost and 127.0.0.1.</p>
<div class="admonition caution">
<p class="admonition-title">PSA</p>
<p>Proxy must have either http:// or https:// at the beginning to be used. Otherwise it will be ignored.</p>
</div>
<div class="tabbed-set" data-tabs="2:3"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><label for="__tabbed_2_1">MAC/Linux</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="nv">http_proxy</span><span class="o">=</span>http://myproxy:8080

<span class="nv">https_proxy</span><span class="o">=</span>http://myproxy:8080

<span class="nv">no_proxy</span><span class="o">=</span><span class="s2">&quot;localhost, 127.0.0.1&quot;</span>
</code></pre></div>

</div>
<input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><label for="__tabbed_2_2">Windows Command Prompt</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="nb">set</span> <span class="nv">http_proxy</span><span class="o">=</span>http://myproxy:8080

<span class="nb">set</span> <span class="nv">https_proxy</span><span class="o">=</span>http://myproxy:8080

<span class="nb">set</span> <span class="nv">no_proxy</span><span class="o">=</span>localhost, <span class="m">127</span>.0.0.1
</code></pre></div>

</div>
<input id="__tabbed_2_3" name="__tabbed_2" type="radio" /><label for="__tabbed_2_3">Windows PowerShell</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="nv">$http_proxy</span> <span class="p">=</span> <span class="s2">&quot;http://myproxy:8080&quot;</span>

<span class="nv">$https_proxy</span> <span class="p">=</span> <span class="s2">&quot;http://myproxy:8080&quot;</span>

<span class="nv">$no_proxy</span> <span class="p">=</span> <span class="s2">&quot;localhost, 127.0.0.1&quot;</span>
</code></pre></div>

</div>
</div>
<h2 id="building-docker-images-behind-proxy">Building Docker images behind Proxy<a class="headerlink" href="#building-docker-images-behind-proxy" title="Permanent link">&para;</a></h2>
<p>There are two main options for building Docker images behind a proxy so that
your build can do things like use apt-get to install packages for the image, wget or curl
to download files or downloading a git repository during the install itself.</p>
<ol>
<li>
<p>Use environment variables in your Dockerfile.</p>
<details class="example" open="open"><summary>Example</summary><div class="highlight"><pre><span></span><code>ENV http_proxy http://docker.for.win.localhost:8888
ENV https_proxy http://docker.for.win.localhost:8888
ENV no_proxy localhost, <span class="m">127</span>.0.0.1
</code></pre></div>

</details>
<p>This means that your settings persist to the Docker image itself. This is in many cases not what you want because this means your users by default will have your proxy settings. If you are using an image internally only then this automatically lets you run the image. However, if you are giving an image to someone who will use it outside of your proxy environment please use the next option for setting proxy so they don't have to worry about the app not working and then having to change the settings themselves when running the Docker container. <img alt="proxy_leaker" src="../images/leak_env.PNG" /></p>
</li>
<li>
<p>Use build args</p>
<p>Build args allow you to provide variables for use during building an image. When the container itself gets used these build args are not present in the container environment. This allows us to build an image using our proxy to do our apt-get installs and curls and then remove this variable so that the user can use their own web environment (proxy or no proxy) instead of by default trying to contact our proxy which they won't be able to reach.</p>
<details class="example" open="open"><summary>Example</summary><div class="highlight"><pre><span></span><code>docker build -t href --build-arg <span class="nv">http_proxy</span><span class="o">=</span>http://docker.for.win.localhost:8888 --build-arg <span class="nv">https_proxy</span><span class="o">=</span>http://docker.for.win.localhost:8888 --build-arg <span class="nv">no_proxy</span><span class="o">=</span>localhost .
</code></pre></div>

</details>
<p>Using our environment variables defined previously this becomes</p>
<div class="tabbed-set" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><label for="__tabbed_3_1">BASH (Mac/Linux)</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code>docker build -t href --build-arg <span class="nv">http_proxy</span><span class="o">=</span><span class="nv">$http_proxy</span> --build-arg <span class="nv">https_proxy</span><span class="o">=</span><span class="nv">$https_proxy</span> --build-arg <span class="nv">no_proxy</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$no_proxy</span><span class="s2">&quot;</span> .
</code></pre></div>

</div>
<input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><label for="__tabbed_3_2">Windows (Command Prompt)</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code>docker build -t href --build-arg http_proxy=<span class="nv">%http_proxy%</span> --build-arg https_proxy=<span class="nv">%https_proxy%</span> --build-arg no_proxy=<span class="s2">&quot;</span><span class="nv">%no_proxy%</span><span class="s2">&quot;</span> .
</code></pre></div>

</div>
</div>
<p>Now, our proxy environment variables don't show up to the end user. <img alt="build args no leak" src="../images/no_leak_env.PNG" /></p>
</li>
<li>
<p>What about if I have confidential information such as a username/password in my proxy?</p>
<p>If you have this info in your proxy environment variables users will be able to see it
in the running container's environment as well as by inspecting the container. If you used build args the user will be able to see it by inspecting the container with <code>docker inspect</code> as well. So what do we do. Well, we can use multi-stage builds which I go over in <a href="../3-Best-Practice-go/">3-Best-Practice-go</a> of this guide to accomplish the task since our final container will only have copies of the files built using the proxy in a previous container. To see how to actually do this look at <a href="https://vsupalov.com/build-docker-image-clone-private-repo-ssh-key/" target="_blank">Accessing Private Repository</a>. You can follow the steps outlined in the article for your proxy with username/password declaration for security.</p>
</li>
</ol>
<h2 id="running-docker-containers-behind-a-proxy">Running Docker containers behind a proxy<a class="headerlink" href="#running-docker-containers-behind-a-proxy" title="Permanent link">&para;</a></h2>
<p>Some Docker container don't reach out to the outside world, so they don't need to worry
about using a proxy. However, a lot of Docker containers need to reach out to do things
such as checking information or sending notifications to websites. In order to do so behind a
proxy the Docker container needs the correct environment variables set. The way to do that is when running the container
use -e with the proxy variables:</p>
<div class="tabbed-set" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><label for="__tabbed_4_1">BASH (Mac/Linux)</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code>docker run --rm -e <span class="nv">http_proxy</span><span class="o">=</span><span class="nv">$http_proxy</span> -e <span class="nv">https_proxy</span><span class="o">=</span><span class="nv">$https_proxy</span> -e <span class="nv">no_proxy</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$no_proxy</span><span class="s2">&quot;</span> mplatform/mquery gmoney23/outyet
</code></pre></div>

</div>
<input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><label for="__tabbed_4_2">Windows (Command Prompt)</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code>docker run --rm -e http_proxy=<span class="nv">%http_proxy%</span> -e https_proxy=<span class="nv">%https_proxy%</span> -e no_proxy=<span class="s2">&quot;</span><span class="nv">%no_proxy%</span><span class="s2">&quot;</span> mplatform/mquery gmoney23/outyet
</code></pre></div>

</div>
</div>
<p>This passes the environment variables to the Docker container.</p>
<p>The fact that somebody thought of you and your proxy situation, fills you with <a href="https://undertale.fandom.com/wiki/Determination" target="_blank">determination</a>.</p>
<h3 id="to-use-a-proxy-with-kubernetes-see-5-deploy-to-kubernetes">To use a proxy with Kubernetes see <a href="../5-Deploy-to-Kubernetes/">5-Deploy-to-Kubernetes</a><a class="headerlink" href="#to-use-a-proxy-with-kubernetes-see-5-deploy-to-kubernetes" title="Permanent link">&para;</a></h3>
<h3 id="reference">Reference<a class="headerlink" href="#reference" title="Permanent link">&para;</a></h3>
<p>If you still have Docker proxy needs see this article <a href="https://elegantinfrastructure.com/docker/ultimate-guide-to-docker-http-proxy-configuration/" target="_blank">Docker Behind a Corporate Firewall</a></p>
<h2 id="onwards">Onwards<a class="headerlink" href="#onwards" title="Permanent link">&para;</a></h2>
<h3 id="part-1-getting-official-with-multi-arch-images"><a href="../1-Official-Multiarch/">Part 1: Getting Official with Multi-arch Images</a><a class="headerlink" href="#part-1-getting-official-with-multi-arch-images" title="Permanent link">&para;</a></h3>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../5-Deploy-to-Kubernetes/" title="5. Kubernetes Time" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                5. Kubernetes Time
              </div>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/siler23" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://hub.docker.com/u/gmoney23" target="_blank" rel="noopener" title="hub.docker.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://linkedin.com/in/garrett-woodworth-9a9895142/" target="_blank" rel="noopener" title="linkedin.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../assets/javascripts/bundle.b39636ac.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.a68abb33.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>